<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>IDWise WebSDK â€“ Full HTML Demo (Start/Resume/Cleanup)</title>

  <!-- âœ… IDWise WebSDK (per docs) -->

  <link href="https://releases.idwise.com/websdk/latest/idwise.min.css" rel="stylesheet" />
  <script src="https://releases.idwise.com/websdk/latest/idwise.min.js"></script>

  <style>
    :root {
      --bg: #f8fafc;
      --card: #ffffff;
      --border: #e5e7eb;
      --text: #111827;
      --muted: #6b7280;
      --primary: #2563eb;
	  --secondary: #dddddd;
      --blackbar: #0f172a;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-size: 14px;
      font-weight: 400;
      letter-spacing: 0.2px;
    }

    /* ðŸ”¹ HEADER â€” bold + black */
    header {
      padding: 14px 20px;
      background: var(--blackbar);
      color: #fff;
    }

    header h1 {
      margin: 0;
      font-size: 15px;
      font-weight: 700;   /* ONLY header bold */
      letter-spacing: 0.3px;
    }

    main {
      padding: 24px;
      max-width: 960px;
      margin: auto;
    }

    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 24px;
    }

    label {
      font-size: 12px;
      font-weight: 500;
      color: var(--muted);
      margin-bottom: 6px;
      display: block;
    }

    input, select, textarea {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 10px;
      font-size: 13px;
      font-weight: 400;
      background: #ffffff;
      color: var(--text);
      transition: border .2s ease;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--primary);
    }

    textarea {
      font-family: ui-monospace, SFMono-Regular, Menlo, monospace;
      min-height: 90px;
    }

    .hint {
      font-size: 12px;
      color: var(--muted);
      margin-top: 5px;
      line-height: 1.4;
    }

    .grid {
      display: grid;
      gap: 16px;
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }

    @media (max-width: 820px) {
      .grid { grid-template-columns: 1fr; }
    }

    /* ðŸ”¹ CTA Buttons â€” normal weight */
    .btnrow {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 18px;
    }

    button {
      padding: 9px 14px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: #ffffff;
      font-size: 13px;
      font-weight: 400;   /* NOT bold */
      cursor: pointer;
      transition: all .2s ease;
    }

    button:hover {
      border-color: #cbd5e1;
    }

    .primary {
      background: var(--primary);
      color: #ffffff;
      border-color: var(--primary);
    }

    .primary:hover { opacity: 0.9; }
	
    .secondary {
      background: var(--secondary);
      color: #000000;
      border-color: var(--secondary);
    }

    .secondary:hover { opacity: 0.9; }

    .danger {
      background: #ef4444;
      color: #fff;
      border-color: #ef4444;
    }

    /* ðŸ”¹ SDK Mount Area */
    .mount {
      margin-top: 22px;
      min-height: 560px;
      border-radius: 14px;
      border: 1px dashed var(--border);
      background: #f9fafb;	  
    }

    /* ðŸ”¹ STATUS PILL (black header theme) */
    .pill {
      font-size: 11px;
      font-weight: 500;
      color: #fff;
      background: var(--blackbar);
      padding: 4px 10px;
      border-radius: 999px;
      margin-left: 8px;
    }

    /* ðŸ”¹ LOG PANEL â€” black */
    .log {
      margin-top: 18px;
      font-size: 12px;
      background: var(--blackbar);
      color: #cbd5e1;
      padding: 14px;
      border-radius: 14px;
      white-space: pre-wrap;
      max-height: 260px;
      overflow: auto;
    }
  </style>

</head>

<body>
  <header>
    <h1>IDWise WebSDK â€“ Full Demo <span class="pill" id="sdkState">Not initialized</span></h1>
  </header>

  <main>
    <div class="card">
      <div class="grid">
        <div>
          <label for="clientKey">Client Key (Mandatory)</label>
          <input id="clientKey" placeholder="Paste your Client Key from IDWise Studio (API Keys â†’ Client Key)" autocomplete="off"
		  value="QmFzaWMgVkMweE5EZzFORGxqT0Mxa00ySXlMVFJpTmpndE9ETmhaQzB3WldZeU56bGlaakV4TTJNNlNXaFJTbFEzTTJ4RlExWjRUMk5YUjJveGRFZzBjbk51ZDNCbWIwMHlaV2xOTUhWblFXMWtVZz09" />
          <div class="hint">
            This is the <b>Client Key</b> used by WebSDK. It is provided/generated in IDWise Studio (Admin Portal â†’ API Keys â†’ Client Key).
          </div>
        </div>

```
    <div>
      <label for="locale">Locale + Theme</label>
      <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 10px;">
        <div>
          <select id="locale">
            <option value="en" selected>en</option>
            <option value="ar">ar</option>
          </select>
          <div class="hint">UI language (default: en).</div>
        </div>
        <div>
          <select id="theme">
            <option value="system_default" selected>system_default</option>
            <option value="light">light</option>
            <option value="dark">dark</option>
          </select>
          <div class="hint">UI theme.</div>
        </div>
      </div>
    </div>

    <div>
      <label for="flowSelect">Journey Flow ID (flowId) (Mandatory)</label>
      <select id="flowSelect">
        <option value="">Select a flowâ€¦</option>
        <!-- âœ… Replace the below with your FULL IDs (not truncated) -->
        <option value="cfbb44a9-dda2-4b29-be2f-b29a3331497b">Other Documents</option>
        <option value="00e001f9-3ece-4fb0-88d1-518eff2b871f">Passport</option>
        <option value="f69f47ff-4ca7-482b-93c7-0874519ec527">Passport &amp; EID</option>        
      </select>      
    </div>

    <div>
	  <label for="referenceNo">referenceNo (Optional but recommended)</label>
	  <div style="display:flex; gap:10px;">
	    <input id="referenceNo" placeholder="Your internal user id (e.g., customerId)" autocomplete="off" />
	    <button type="button" class="secondary" id="genUuidBtn">Generate UUID</button>
	  </div>
	  <div class="hint">
	    This links the journey to your system. You can auto-generate a UUID for testing.
	  </div>
    </div>

    <div>
      <label for="journeyId">journeyId (Required only for Resume)</label>
      <input id="journeyId" placeholder="Paste existing journeyId to resume" autocomplete="off" />
      <div class="hint">
        Youâ€™ll get a journeyId from events like <b>onJourneyStarted</b>. Store it if you want resume support.
      </div>
    </div>

    <div>
      <label>Applicant Details (Optional)</label>
      <textarea id="applicantDetails" spellcheck="false">
{
"full_name": "Peyman Atarzadeh",
"nationality_code": "UAE"
} 
 </textarea> <div class="hint">
Set to <b>null</b> if you donâ€™t want to pass details. Supported keys per docs. </div> </div> </div>

```
  <div class="btnrow">
    <button class="primary" id="btnInit">1) Initialize</button>
    <button class="primary" id="btnStart">2) Start Journey</button>
    <button class="secondary" id="btnResume">Resume Journey</button>
    <button class="danger" id="btnCleanup">Cleanup (Cancel)</button>
    <button class="secondary" id="btnClearLog">Clear Log</button>
  </div>

  <div class="hint">
    <span class="warn">If initialize fails:</span> most common causes are invalid Client Key, wrong tenant/region, or running on an insecure origin.
    Host this on <b>https</b> (GitHub Pages / Netlify / Vercel) and open it from the hosted URL.
  </div>

  <!-- âœ… Mount point required by startJourney/resumeJourney -->
  <div id="idwise-mount" class="mount"></div>

  <div id="log" class="log">Log:\n</div>
</div>
```

  </main>

  <script>
    // -----------------------------
    // IDWise WebSDK demo - per docs:
    // IDWise.initialize({ clientKey, locale, theme }) -> Promise<session>
    // session.startJourney({ flowId, mount, applicantDetails, referenceNo, eventHandlers })
    // session.resumeJourney({ flowId, mount, journeyId, eventHandlers })
    // session.cleanup()
    // -----------------------------

    const $ = (id) => document.getElementById(id);
    const logEl = $("log");
    const stateEl = $("sdkState");

    let idwise = null; // session instance returned by IDWise.initialize()

    function log(msg, obj) {
      const line = obj ? `${msg} ${safeJson(obj)}` : msg;
      logEl.textContent += line + "\n";
      logEl.scrollTop = logEl.scrollHeight;
      console.log(line);
    }

    function safeJson(x) {
      try { return JSON.stringify(x); } catch { return String(x); }
    }

    function getFlowId() {
      const v = $("flowSelect").value;
      if (v === "__custom__") return $("flowCustom").value.trim();
      return v.trim();
    }

    function getApplicantDetails() {
      const raw = $("applicantDetails").value.trim();
      if (!raw) return null;
      // allow user to type "null"
      if (raw === "null") return null;
      try { return JSON.parse(raw); }
      catch (e) {
        throw new Error("Applicant Details is not valid JSON. Either fix JSON or set it to null.");
      }
    }

    function setState(text) {
      stateEl.textContent = text;
    }

    // Toggle custom flow input
    $("flowSelect").addEventListener("change", () => {
      const isCustom = $("flowSelect").value === "__custom__";
      $("flowCustom").style.display = isCustom ? "block" : "none";
      if (!isCustom) $("flowCustom").value = "";
    });

    // Helpful pre-flight checks
    function preflightChecks() {
      if (!window.IDWise) {
        log("âŒ IDWise SDK not found on window. Check script tag: https://releases.idwise.com/websdk/latest/idwise.min.js");
        return false;
      }
      return true;
    }

    // 1) Initialize (per docs)
    $("btnInit").addEventListener("click", async () => {
      if (!preflightChecks()) return;

      const clientKey = $("clientKey").value.trim();
      const locale = $("locale").value;
      const theme = $("theme").value;

      if (!clientKey) {
        alert("Client Key is required.");
        return;
      }

      try {
        log("Initializing IDWiseâ€¦");
        setState("Initializingâ€¦");

        idwise = await IDWise.initialize({ clientKey, locale, theme });

        setState("Initialized âœ…");
        log("âœ… Initialized. Session ready.");
      } catch (err) {
        setState("Init failed âŒ");
        log("âŒ Initialize failed:", normalizeError(err));
        alert("Initialize failed. Check the log for details.");
      }
    });

    // 2) Start Journey (per docs)
    $("btnStart").addEventListener("click", async () => {
      if (!preflightChecks()) return;

      const flowId = getFlowId();
      const referenceNo = $("referenceNo").value.trim() || undefined;

      if (!flowId) {
        alert("flowId is required (select a Journey Flow).");
        return;
      }

      try {
        if (!idwise) {
          alert("Please click Initialize first.");
          return;
        }

        // Per docs: cleanup before starting a new journey within same page/session
        log("Calling cleanup() before starting a new journey (recommended)...");
        try { await idwise.cleanup(); } catch { /* ignore */ }

        const applicantDetails = getApplicantDetails();

        log("Starting journeyâ€¦");
        setState("Journey runningâ€¦");

        idwise.startJourney({
          flowId,
          mount: "#idwise-mount",
          applicantDetails,
          referenceNo,
          eventHandlers: {
            onJourneyStarted: (details) => {
              log("âœ… onJourneyStarted:", details);
              // Tip: store details.journeyId to DB if you want resume support
              if (details?.journeyId) $("journeyId").value = details.journeyId;
            },
            onJourneyFinished: (details) => {
              log("âœ… onJourneyFinished:", details);
              setState("Initialized âœ… (journey finished)");
            },
            onJourneyCancelled: (details) => {
              log("âš ï¸ onJourneyCancelled:", details);
              setState("Initialized âœ… (journey cancelled)");
            },
            onError: (details) => {
              log("âŒ onError:", details);
              setState("Initialized âœ… (error)");
            }
          }
        });

      } catch (err) {
        log("âŒ startJourney exception:", normalizeError(err));
        alert("Start Journey failed. Check the log for details.");
      }
    });

    // Resume Journey (per docs)
    $("btnResume").addEventListener("click", async () => {
      if (!preflightChecks()) return;

      const flowId = getFlowId();
      const journeyId = $("journeyId").value.trim();

      if (!flowId) {
        alert("flowId is required (select a Journey Flow).");
        return;
      }
      if (!journeyId) {
        alert("journeyId is required to resume.");
        return;
      }

      try {
        if (!idwise) {
          alert("Please click Initialize first.");
          return;
        }

        log("Calling cleanup() before resuming (recommended)...");
        try { await idwise.cleanup(); } catch { /* ignore */ }

        log("Resuming journeyâ€¦");
        setState("Journey runningâ€¦");

        idwise.resumeJourney({
          flowId,
          mount: "#idwise-mount",
          journeyId,
          eventHandlers: {
            onJourneyResumed: (details) => {
              log("âœ… onJourneyResumed:", details);
            },
            onJourneyFinished: (details) => {
              log("âœ… onJourneyFinished:", details);
              setState("Initialized âœ… (journey finished)");
            },
            onJourneyCancelled: (details) => {
              log("âš ï¸ onJourneyCancelled:", details);
              setState("Initialized âœ… (journey cancelled)");
            },
            onError: (details) => {
              log("âŒ onError:", details);
              setState("Initialized âœ… (error)");
            }
          }
        });

      } catch (err) {
        log("âŒ resumeJourney exception:", normalizeError(err));
        alert("Resume Journey failed. Check the log for details.");
      }
    });

    // Cleanup (Cancel) per docs
    $("btnCleanup").addEventListener("click", async () => {
      try {
        if (!idwise) {
          log("cleanup(): session not initialized yet.");
          return;
        }
        log("Calling cleanup()â€¦");
        await idwise.cleanup();
        log("âœ… cleanup() completed. UI removed / journey cancelled.");
        setState("Initialized âœ… (clean)");
      } catch (err) {
        log("âŒ cleanup() failed:", normalizeError(err));
      }
    });

    $("btnClearLog").addEventListener("click", () => {
      logEl.textContent = "Log:\n";
    });

    function normalizeError(err) {
      // IDWise docs show errors can be objects with code/message/requestId
      if (!err) return { message: "Unknown error (empty)" };
      if (typeof err === "string") return { message: err };
      return {
        code: err.code,
        message: err.message || String(err),
        requestId: err.requestId,
        raw: err
      };
    }

    // Auto-log environment
    window.addEventListener("load", () => {
      log("Page loaded.");
      log("SDK present:", { IDWise: !!window.IDWise });
      log("Origin:", { origin: window.location.origin, protocol: window.location.protocol });
      if (window.location.protocol !== "https:" && window.location.hostname !== "localhost") {
        log("âš ï¸ Not running on HTTPS. Some browsers/features may block camera access.", { protocol: window.location.protocol });
      }
    });
	
	// Generate UUID v4
	$("genUuidBtn").addEventListener("click", () => {
	  if (window.crypto && crypto.randomUUID) {
	    $("referenceNo").value = crypto.randomUUID();
	  } else {
	    // Fallback if randomUUID not supported
	    $("referenceNo").value = "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, c => {
	      const r = Math.random() * 16 | 0;
	      const v = c === "x" ? r : (r & 0x3 | 0x8);
	      return v.toString(16);
	    });
	  }
	});	
	
  </script>

</body>
</html>
